%TVC Ameriflux Submission
%go to folder MATLAB/TVC
%made by Haley Alcock, December 2020, haleyalcock@gmail.com

    load TVC_EPOutputs.mat
    load QAQC_TVCdata.mat
    load TVC_CO2filled.mat
    load TVC_Ch4filled.mat
    load TVC_NEE_partitioned.mat
%%

%use only 2017
TIMESTAMP = datestr(MATLABTIME_EP(20210:37730),'yyyymmddhhMM');

TIMESTAMP_START	= TIMESTAMP(1:end-1,:); 
TIMESTAMP_END = TIMESTAMP(2:end,:);  
FC = CO2_EP.co2_flux(20210:37729);
CO2 = CO2_EP.co2_mole_fraction(20210:37729);
FC_SSITC_TEST = CO2_EP.qc_co2_flux(20210:37729);
SC = CO2_EP.co2_strg(20210:37729);
H = CO2_EP.H(20210:37729);	
H_SSITC_TEST = CO2_EP.qc_H(20210:37729);	
LE = CO2_EP.LE(20210:37729);
H2O	= CO2_EP.h2o_mole_fraction(20210:37729);
LE_SSITC_TEST = CO2_EP.qc_LE(20210:37729);
SH = CO2_EP.H_strg(20210:37729);
SLE	= CO2_EP.LE_strg(20210:37729);
WD = QAQCdata.WindDir(70129:87648); 		
WS_1_1_1 = QAQCdata.WindSpeed_10m(70129:87648); 
WS_2_1_1 = QAQCdata.WindSpeed_7m(70129:87648);	
USTAR = QAQCdata.ustar(70129:87648);
MO_LENGTH = CO2_EP.L(20210:37729);
ZL = CO2_EP.zdL(20210:37729);
V_SIGMA	= CO2_EP.v_var(20210:37729);
W_SIGMA	= CO2_EP.w_var(20210:37729);
PA = QAQCdata.AirP(70129:87648);	
RH = QAQCdata.RH(70129:87648);		
VPD	= QAQCdata.VPD(70129:87648);
TA = QAQCdata.AirT(70129:87648);	
T_SONIC	= CO2_EP.air_temperature(20210:37729);
ALB = QAQCdata.albedo(70129:87648);
SW_IN = QAQCdata.SWin(70129:87648);
SW_OUT = QAQCdata.SWout(70129:87648);
LW_IN = QAQCdata.LWin(70129:87648);	
LW_OUT = QAQCdata.LWout(70129:87648);
PPFD_IN	= QAQCdata.PPFDin(70129:87648);
PPFD_OUT = QAQCdata.PPFDout(70129:87648);
P = QAQCdata.precip(70129:87648);
D_SNOW = QAQCdata.snowDepth(70129:87648);	
FCH4 = CH4_EP.ch4_flux(61799:79318);
FCH4_SSITC_TEST	= CH4_EP.qc_ch4_flux(61799:79318);
SCH4= CH4_EP.ch4_strg(61799:79318);	
FCH4_PI = CH4_filt(61799:79318);
FCH4_F_PI = CH4_filled_2(61799:79318);	
NEE_PI = CO2_filt(20210:37729);	
NEE_F_PI = CO2_filled_2(20210:37729);		
GPP_PI = GPP(20210:37729);		
RECO_PI = Reco(20210:37729);	

TVC_HH_201701010000_201801010000 = table(TIMESTAMP_START,TIMESTAMP_END,FC,CO2,FC_SSITC_TEST,...
    SC,H,H_SSITC_TEST,LE,H2O,LE_SSITC_TEST,SH,SLE,WD,WS_1_1_1,WS_2_1_1,USTAR,MO_LENGTH,ZL,V_SIGMA,...
    W_SIGMA,PA,RH,VPD,TA,T_SONIC,ALB,SW_IN,SW_OUT,LW_IN,LW_OUT,PPFD_IN,PPFD_OUT,P,D_SNOW,FCH4,...
    FCH4_SSITC_TEST,SCH4,FCH4_PI,FCH4_F_PI,NEE_PI,NEE_F_PI,GPP_PI,RECO_PI);

writetable(TVC_HH_201701010000_201801010000 ,'CA-TVC_HH_201701010000_201801010000.csv','Delimiter',',')


